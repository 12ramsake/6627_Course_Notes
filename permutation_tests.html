<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Notes for MATH 6627: Statistical Consulting Practicum - 3&nbsp; Permutation Tests</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./glmm.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./permutation_tests.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Permutation Tests</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Notes for MATH 6627: Statistical Consulting Practicum</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mixed_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Mixed Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Generalized linear mixed models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./permutation_tests.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Permutation Tests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">3.1</span> Introduction</a></li>
  <li><a href="#the-permutation-lemma" id="toc-the-permutation-lemma" class="nav-link" data-scroll-target="#the-permutation-lemma"><span class="header-section-number">3.2</span> The Permutation Lemma</a></li>
  <li><a href="#adding-in-t" id="toc-adding-in-t" class="nav-link" data-scroll-target="#adding-in-t"><span class="header-section-number">3.3</span> Adding in <span class="math inline">\(T\)</span></a></li>
  <li><a href="#an-example" id="toc-an-example" class="nav-link" data-scroll-target="#an-example"><span class="header-section-number">3.4</span> An example</a></li>
  <li><a href="#permutation-test-for-independence" id="toc-permutation-test-for-independence" class="nav-link" data-scroll-target="#permutation-test-for-independence"><span class="header-section-number">3.5</span> Permutation test for independence</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-pt" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Permutation Tests</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The following notes are adapted from <a href="https://dylanspicker.quarto.pub/permutation-tests/">these notes</a>.</p>
<section id="introduction" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">3.1</span> Introduction</h2>
<p>Here, we briefly cover permutation tests. These are a class of nonparametric hypothesis tests for checking equality of distributions. Let’s start with an example.</p>
<p>Suppose we sample <span class="math inline">\(n\)</span> observations from <span class="math inline">\(F\)</span>, denoted <span class="math inline">\((X_{1},\ldots,X_n)\)</span> and <span class="math inline">\(m\)</span> from <span class="math inline">\(G\)</span>, denoted <span class="math inline">\((X_{n+1},\ldots,X_{n+m})\)</span>. Then, we wish to test <span class="math display">\[H_0 : F=G \qquad vs.  \qquad H_1: F\neq G.\]</span> Suppose we have some test statistic which is a measure of a difference between groups, for example, the Kolmogrov-Smirnoff statistic: <span class="math display">\[T^*= T(\ (X_{1},\ldots,X_n),\ (X_{n+1},\ldots,X_{n+m})\ )=||F_m-G_n||.\]</span></p>
<p>Here, <span class="math inline">\(T\)</span> measures the distance between the empirical distributions from each sample. Recall then that if we want to do a hypothesis test, we need to compute the distribution of <span class="math inline">\(T\)</span> under the null hypothesis.</p>
<p>Under the null hypothesis, we have that <span class="math inline">\((X_{1},\ldots,X_n)\)</span> is equal in distribution to <span class="math inline">\((X_{n+1},\ldots,X_{n+m})\)</span>. This means that the labels 1,…,<span class="math inline">\(n+m\)</span> are arbitrary, in the sense that all observations come from the same population, so the division into the two groups holds no meaning. Furthermore, for any permutation <span class="math inline">\(\pi_1,\ldots,\pi_{n+m}\)</span>, it holds that <span class="math inline">\((X_{\pi_1},\ldots,X_{\pi_n})\)</span> is equal in distribution to <span class="math inline">\((X_{\pi_{n+1}},\ldots,X_{\pi_{n+m}})\)</span>. This implies that <span class="math inline">\(T(\ (X_{1},\ldots,X_n),\ (X_{n+1},\ldots,X_{n+m})\ )\)</span> is equal in distribution to <span class="math inline">\(T(\ (X_{\pi_1},\ldots,X_{\pi_n}),\ (X_{\pi_{n+1}},\ldots,X_{\pi_{n+m}})\ )\)</span>. This fact motivates the following procedure:</p>
<ol type="1">
<li>Draw a random permutation <span class="math inline">\(\pi\)</span> from the set of <span class="math inline">\((n+m)!\)</span> permutations</li>
<li>Compute <span class="math inline">\(T(\ (X_{\pi_1},\ldots,X_{\pi_n}),\ (X_{\pi_{n+1}},\ldots,X_{\pi_{n+m}})\ )\)</span></li>
<li>Repeat 1 and 2 <span class="math inline">\(K\)</span> times to obtain <span class="math inline">\(K\)</span> values <span class="math inline">\(T_1,...,T_K\)</span></li>
<li>Let <span class="math inline">\(\mu_K\)</span> be the empirical distribution of <span class="math inline">\(T^*,T_1,...,T_K\)</span></li>
<li>Compute the p-value: <span class="math inline">\(\Pr_{\mu_K}(X\geq T^*)\)</span></li>
</ol>
<p>The above is a two-sample permutation test! Let’s add some rigor.</p>
</section>
<section id="the-permutation-lemma" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="the-permutation-lemma"><span class="header-section-number">3.2</span> The Permutation Lemma</h2>
<p>Consider again, <span class="math inline">\(X_{1},\ldots,X_{n}\sim F\)</span> and <span class="math inline">\(X_{n+1},\ldots,X_{n+m}\sim F\)</span>. Denote by <span class="math inline">\(Y_1,\ldots,Y_{n+m}\)</span> the order statistics of the combined sample <span class="math inline">\(X_{1},\ldots,X_{n+m}\)</span>. Now, let <span class="math inline">\(V_i=1(Y_i\in \{X_{1},\ldots,X_{m}\})\)</span>. <!-- Now, the pairs $\{(Y_i,V_i)\}_{i=1}^{n+m}$ yield the same information as the samples and their respective labels. In other words, there is a bijection between $\{(Y_i,V_i)\}_{i=1}^{n+m}$ and $(X_{1},\ldots X_n),(X_{n+1},\ldots,X_{n+m})$.  --></p>
<p>Now, note that <span class="math inline">\(Y_1,\ldots,Y_{n+m}=X_{\pi_1},\ldots,X_{\pi_n},X_{\pi_{n+1}},\ldots,X_{\pi_{n+m}}\)</span> for some permutation <span class="math inline">\(\pi\)</span>. Furthermore, <span class="math inline">\(\pi\)</span> has to be uniformly distributed across all possible permutations, on account of the <span class="math inline">\(X_i\)</span> being iid. Therefore, the probability of a given permutation generated by the order statistics is <span class="math inline">\(1/(n+m)!\)</span>.</p>
<p>Next, note each permutation generates a <span class="math inline">\((V_1,\ldots,V_{n+m})\)</span>. Now, the probability of observing any <span class="math inline">\((V_1,\ldots,V_{n+m})\)</span> is the number of permutations such that the same <span class="math inline">\(m\)</span> elements are in the first sample. This is given by <span class="math inline">\(n!m!\)</span>. Given that the permutations are uniformly distributed, we have that the probability that <span class="math inline">\((V_1,\ldots,V_{n+m})=(v_1,\ldots,v_{n+m})=n!m!/(n+m)!\)</span>. Therefore, under the null hypothesis, every permutation is equally likely and so the distribution of the vector <span class="math inline">\((V_1,\ldots,V_n)\)</span> is uniform over <span class="math inline">\(\binom{n+m}{m}\)</span>. This has been referred to as the <strong>permutation lemma</strong>.</p>
</section>
<section id="adding-in-t" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="adding-in-t"><span class="header-section-number">3.3</span> Adding in <span class="math inline">\(T\)</span></h2>
<p>Now, we may ask where <span class="math inline">\(T\)</span> comes in. Let <span class="math inline">\(\mathbf{X}_1=(X_{1},\ldots,X_n)\)</span> and <span class="math inline">\(\mathbf{X}_2=(X_{n+1},\ldots,X_{n+m})\)</span>. Let <span class="math inline">\(\mathbf{Y}\)</span> be the combined sample order statistics and <span class="math inline">\(\mathbf{V}\)</span> be the label indicators. We can write:</p>
<p><span class="math display">\[\begin{align*}
\Pr(T(\mathbf{X}_1,\mathbf{X}_2)\geq t|\mathbf{Y})&amp;=\Pr(T(\mathbf{V},\mathbf{Y})\geq t|\mathbf{Y})\\
&amp;=\sum_{i=1}^{\binom{n+m}{m}}\Pr(T(v,\mathbf{Y})\geq t,\mathbf{V}=v|\mathbf{Y})\\
&amp;=\sum_{i=1}^{\binom{n+m}{m}}1(T(v,\mathbf{Y})\geq t)\Pr(\mathbf{V}=v|\mathbf{Y})\\
&amp;=\#\text{ labellings such that } T(v,\mathbf{Y})\geq t\big / \binom{n+m}{m} .
\end{align*}\]</span></p>
<p>This probability is: <strong>the probability that we observe a value for our statistic at least as extreme as, assuming that the null hypothesis is true, given the set of values that we have observed.</strong> Now then, <span class="math display">\[p=\#\text{ labellings such that } T(v,\mathbf{Y})\geq t)\big / \binom{n+m}{m}\]</span> is the p-value, conditional on the combined sample order statistics we observed.</p>
</section>
<section id="an-example" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="an-example"><span class="header-section-number">3.4</span> An example</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8235</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">=</span><span class="fu">rnorm</span>(n)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">rnorm</span>(n,<span class="dv">2</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>TS<span class="ot">=</span><span class="fu">ks.test</span>(X,Y)<span class="sc">$</span>statistic</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>permutation_test<span class="ot">=</span><span class="cf">function</span>(X,Y,<span class="at">test_stat=</span><span class="cf">function</span>(x,y){<span class="fu">ks.test</span>(x,y)<span class="sc">$</span>statistic},<span class="at">K=</span><span class="dv">1000</span>){</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  combined<span class="ot">=</span><span class="fu">c</span>(X,Y)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">length</span>(X)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  n<span class="ot">=</span><span class="fu">length</span>(<span class="fu">c</span>(X,Y))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  permutations<span class="ot">=</span><span class="fu">replicate</span>(K,<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n,n))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  com_Tstar<span class="ot">=</span><span class="cf">function</span>(permutation){<span class="fu">test_stat</span>(combined[permutation[<span class="dv">1</span><span class="sc">:</span>m]],combined[permutation[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>m)]])}</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  Ts<span class="ot">=</span><span class="fu">apply</span>(permutations,<span class="dv">2</span>,com_Tstar)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  Tss<span class="ot">=</span><span class="fu">test_stat</span>(X,Y)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">mean</span>(Tss<span class="sc">&lt;=</span><span class="fu">c</span>(Tss,Ts))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">permutation_test</span>(X,Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000999001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many samples do we need?</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>simulate_test<span class="ot">=</span><span class="cf">function</span>(){</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  Y<span class="ot">=</span><span class="fu">rnorm</span>(n)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  X<span class="ot">=</span><span class="fu">rnorm</span>(n,<span class="dv">2</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">permutation_test</span>(X,Y)}</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">100</span>,<span class="fu">simulate_test</span>())<span class="sc">&lt;=</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.88</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>simulate_t_test<span class="ot">=</span><span class="cf">function</span>(){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  Y<span class="ot">=</span><span class="fu">rnorm</span>(n)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  X<span class="ot">=</span><span class="fu">rnorm</span>(n,<span class="dv">2</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t.test</span>(X,Y)<span class="sc">$</span>p.value}</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">100</span>,<span class="fu">simulate_t_test</span>())<span class="sc">&lt;=</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.99</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A second exmaple</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>simulate_test<span class="ot">=</span><span class="cf">function</span>(){</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  Y<span class="ot">=</span><span class="fu">rexp</span>(n)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  X<span class="ot">=</span><span class="fu">rexp</span>(n,<span class="dv">2</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">permutation_test</span>(X,Y)}</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>simulate_test_2<span class="ot">=</span><span class="cf">function</span>(){</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  Y<span class="ot">=</span><span class="fu">rexp</span>(n)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  X<span class="ot">=</span><span class="fu">rexp</span>(n,<span class="dv">2</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">permutation_test</span>(X,Y,<span class="cf">function</span>(x,y){<span class="fu">t.test</span>(x,y)<span class="sc">$</span>statistic})</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>simulate_t_test<span class="ot">=</span><span class="cf">function</span>(){</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  Y<span class="ot">=</span><span class="fu">rexp</span>(n)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  X<span class="ot">=</span><span class="fu">rexp</span>(n,<span class="dv">2</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t.test</span>(X,Y)<span class="sc">$</span>p.value}</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">50</span>,<span class="fu">simulate_test</span>())<span class="sc">&lt;=</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.08</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">50</span>,<span class="fu">simulate_test_2</span>())<span class="sc">&lt;=</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">50</span>,<span class="fu">simulate_t_test</span>())<span class="sc">&lt;=</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.24</code></pre>
</div>
</div>
<p>A second example – heavy tails:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8235</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">35</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>simulate_test<span class="ot">=</span><span class="cf">function</span>(){</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  Y<span class="ot">=</span><span class="fu">rnorm</span>(n)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  X<span class="ot">=</span><span class="fu">rt</span>(n,<span class="dv">3</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">permutation_test</span>(X,Y)}</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>simulate_t_test<span class="ot">=</span><span class="cf">function</span>(){</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  Y<span class="ot">=</span><span class="fu">rnorm</span>(n)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  X<span class="ot">=</span><span class="fu">rt</span>(n,<span class="dv">3</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t.test</span>(X,Y)<span class="sc">$</span>p.value}</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">100</span>,<span class="fu">simulate_test</span>())<span class="sc">&lt;=</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">100</span>,<span class="fu">simulate_t_test</span>())<span class="sc">&lt;=</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07</code></pre>
</div>
</div>
<p>Notes:</p>
<ul>
<li>We should take <span class="math inline">\(K\)</span> as large as feasible. 1000 is a rule of thumb.</li>
<li>The test statistic chosen has a large impact on the power. It is important to choose a test statistic that will perform well for the problem at hand. For instance, does it need to be robust, efficient computationally? What distributional differences are we most concerned about?</li>
<li>Of course in simple problems, they will have lower power than optimal tests. However, they are suitable for situations where an optimal test is not easily derived, or the sample size is too low for asymptotic approximations. They are also easy to implement and relatively intuitive (you don’t need to understand the CLT.)</li>
<li>Permutation tests are mathematically valid because the data are exchangeable under the null hypothesis. We have to be careful that this is directly implied by our assumptions and null hypothesis. For instance, in the setup from the introduction, the null hypothesis $ E_F(X)=E_G(X)$ is not enough to give exchangeability of the data, since we have only assumed the data come from <span class="math inline">\(F\)</span> and <span class="math inline">\(G\)</span>, and it could be that <span class="math inline">\(F\neq G\)</span> but <span class="math inline">\(E_F(X)=E_G(X)\)</span>. In that case, assuming <span class="math inline">\(H_0\)</span> alone is not enough to imply that <span class="math inline">\((X_{1},\ldots,X_n)\)</span> is equal in distribution to <span class="math inline">\((X_{n+1},\ldots,X_{n+m})\)</span>. However, if in addition, we assume that <span class="math inline">\(F\)</span> and <span class="math inline">\(G\)</span> are in the family of normal distributions with variance 1, then we have that <span class="math inline">\((X_{1},\ldots,X_n)\)</span> is equal in distribution to <span class="math inline">\((X_{n+1},\ldots,X_{n+m})\)</span>.</li>
</ul>
</section>
<section id="permutation-test-for-independence" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="permutation-test-for-independence"><span class="header-section-number">3.5</span> Permutation test for independence</h2>
<p>Suppose that instead we observe <span class="math inline">\(((X_1,Y_1),\ldots,(X_n,Y_n))\sim F_{XY}\)</span>, where <span class="math inline">\(X_i\sim F_X\)</span> and <span class="math inline">\(Y_i\sim F_Y\)</span>. Suppose that we wish to test if <span class="math inline">\(X_i\)</span> are independent of <span class="math inline">\(Y_i\)</span>. One way to phrase this is <span class="math display">\[H_0 : F_{XY}=F_XF_Y \qquad vs. \qquad H_1: F_{XY}\neq F_XF_Y.\]</span> Now, under the null hypothesis, by definition, conditioning on <span class="math inline">\(X_i\)</span> tells us nothing about the distribution of <span class="math inline">\(Y_i\)</span>. Therefore, <span class="math inline">\(((X_1,Y_1),\ldots,(X_n,Y_n))\)</span> is equal in distribution to <span class="math inline">\(((X_1,Y_{\pi_1}),\ldots,(X_n,Y_{\pi_n}))\)</span> for any permuation <span class="math inline">\(\pi\)</span>. Then, still under the null hypothesis, the pairings we observed were arbritrary. In fact, it is easy to see that the pairings are uniformly distributed accross the permutations of the <span class="math inline">\(Y_i\)</span>s. In this case, we draw many ``permutation samples’’ <span class="math inline">\(((X_1,Y_{\pi_1}),\ldots,(X_n,Y_{\pi_n}))\)</span>, and compute some statistic <span class="math inline">\(T\)</span> which measures the dependence between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. For instance, we may use <span class="math display">\[\sup_{(x_1,x_2)\in\mathbb{R}^2}|F_{XY}((x_1,x_2))-F_X(x_1)F_Y(x_2)|.\]</span> This test is implemented in the <code>robusTest</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mv.ks.statistic <span class="ot">=</span> <span class="cf">function</span>(X, Y) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">length</span>(X)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The matrix under the assumption of independence is simply the </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># product of [i/n][j/n] for the (i,j)-th entry of the matrix</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  indep_mat <span class="ot">=</span> <span class="fu">as.matrix</span>((<span class="dv">1</span><span class="sc">:</span>n)<span class="sc">/</span>n) <span class="sc">%*%</span> <span class="fu">t</span>(<span class="dv">1</span><span class="sc">:</span>n<span class="sc">/</span>n)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the maximum difference</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(<span class="fu">abs</span>(robusTest<span class="sc">::</span><span class="fu">ecdf2D</span>(X, Y)<span class="sc">$</span>ecdf <span class="sc">-</span> indep_mat))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">31415</span>) </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate X and Y dependent; X and W independent</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> <span class="dv">4</span><span class="sc">*</span>X <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>W <span class="ot">=</span> <span class="fu">rexp</span>(n)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the statistics</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">=</span> <span class="fu">mv.ks.statistic</span>(X, Y)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">=</span> <span class="fu">mv.ks.statistic</span>(X, W)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>results_mat <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> K, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  Xs <span class="ot">=</span> X[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, n)]</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  results_mat[ii, ] <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">mv.ks.statistic</span>(Xs, Y),</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">mv.ks.statistic</span>(Xs, W))</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the results</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(<span class="at">y =</span> results_mat, </span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(results_mat)),</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">rep</span>(<span class="dv">2</span>, <span class="fu">nrow</span>(results_mat))),</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrow =</span> <span class="fu">nrow</span>(results_mat)),</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">pch =</span> <span class="dv">19</span>,</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Estimated Value"</span>,</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">xaxt =</span> <span class="st">'n'</span>, </span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>),</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(<span class="fu">c</span>(results_mat, t1, t2))),</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">'Test (#1 and #2)'</span>)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> t1, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">'black'</span>)</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> t2, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">'red'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="permutation_tests_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We could just directly use the function: <code>robusTest::indeptest(X,Y)</code>.</p>
<p>For more information, see <a href="https://dylanspicker.quarto.pub/permutation-tests/">these notes</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./glmm.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Generalized linear mixed models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>